<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../frontend/css/nav_css.css">

    <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <script src="../../node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script src="../../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="../../node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

        <script src="../../frontend/nav_jss/nav.js"></script>


    <title>Admin Dashboard</title>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="../admin_dashboard/admin_dashboard.html">Admin Dashboard</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item active">
                    <a class="nav-link" href="../admin_dashboard/admin_dashboard.html">Home <span
                            class="sr-only"></span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../admin_car_front_end/add_new_car.html">Add Car</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../admin_office_front_end/add_new_office.html">Add Office</a>
                </li>
            </ul>
        </div>
    </div>
</nav>


    <div class="container mt-4">
        <h3>All Cars</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Car Name</th>
                    <th>Brand</th>
                    <th>Year</th>
                    <th>Image</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="carTableBody">
                <!-- Cars will be dynamically added here through AJAX -->
            </tbody>
        </table>
    </div>


</body>



    <script>
        $(document).ready(function () {
            // Fetch car data using AJAX
            $.ajax({
                type: 'GET',
                url: 'http://localhost/final_db_admin/backend/admin_dashboard_controller/admin_get_all_cars.php', // Replace with the actual file path
                dataType: 'json',
                success: function (data) {
                    // Populate the car table
                    var carTableBody = $('#carTableBody');
                    carTableBody.empty();
                    $.each(data, function (index, car) {
                        var editButton = '<button class="btn btn-primary" onclick="editCar(' + car.id + ')">Edit</button>';
                        var deleteButton = '<button class="btn btn-danger" onclick="deleteCar(' + car.id + ')">Delete</button>';
                        var row = '<tr><td>' + car.carname + '</td><td>' + car.brand + '</td><td>' + car.year + '</td><td><img src="' + car.imageUrl + '" alt="Car Image" style="max-width: 100px; max-height: 100px;"></td><td>' + car.carStatus + '</td><td>' + editButton + ' ' + deleteButton + '</td></tr>';
                        carTableBody.append(row);
                    });
                },
                error: function (xhr, status, error) {
                    console.error(xhr.responseText);
                    alert('Error loading cars: ' + xhr.responseText);
                },
            });


             window.editCar = function (carId) {
                // Redirect to the edit car page with the car ID
                window.location.href = '../admin_car_front_end/edit_car.html?carId=' + carId;
            };

            // Function to handle deleting a car
            window.deleteCar = function (carId) {
                // Display SweetAlert2 confirmation dialog
                Swal.fire({
                    title: 'Are you sure?',
                    text: "Once deleted, you won't be able to recover this car record!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // If user confirms, send AJAX request to delete the car
                        $.ajax({
                            type: 'POST',
                            url: 'http://localhost/final_db_admin/backend/admin_car_controller/admin_delete_car.php', // Replace with the actual file path
                            data: { carId: carId },
                            success: function (response) {
                                // Reload the table after successful deletion
                                fetchCarData();
                            },
                            error: function (xhr, status, error) {
                                console.error(xhr.responseText);
                                alert('Error deleting car: ' + xhr.responseText);
                            },
                        });
                    }
                });
            };

            // Function to fetch car data
            function fetchCarData() {
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost/final_db_admin/backend/admin_dashboard_controller/admin_get_all_cars.php', // Replace with the actual file path
                    dataType: 'json',
                    success: function (data) {
                        // Populate the car table
                        var carTableBody = $('#carTableBody');
                        carTableBody.empty();
                        $.each(data, function (index, car) {
                            var editButton = '<button class="btn btn-primary" onclick="editCar(' + car.id + ')">Edit</button>';
                            var deleteButton = '<button class="btn btn-danger" onclick="deleteCar(' + car.id + ')">Delete</button>';
                            var row = '<tr><td>' + car.carname + '</td><td>' + car.brand + '</td><td>' + car.year + '</td><td><img src="' + car.imageUrl + '" alt="Car Image" style="max-width: 100px; max-height: 100px;"></td><td>' + car.carStatus + '</td><td>' + editButton + ' ' + deleteButton + '</td></tr>';
                            carTableBody.append(row);
                        });
                    },
                    error: function (xhr, status, error) {
                        console.error(xhr.responseText);
                        alert('Error loading cars: ' + xhr.responseText);
                    },
                });
            }

            // Initial fetch when the page loads
            $(document).ready(function () {
                fetchCarData();
            });
        });
    </script>
</body>

</html>